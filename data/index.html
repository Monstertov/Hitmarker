<!DOCTYPE html>
<html>
  <head>
    <title>Hitmarker</title>
    <meta name="viewport" content="width=device-width" />
    
    <link href="data:image/x-icon;base64,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" rel="icon" type="image/x-icon">
    <style>
      .console {
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 10px;
        margin: 20px;
      }
      .output {
        min-height: 200px;
        padding: 5px;
        background-color: #f5f5f5;
        border: 1px solid #ddd;
        border-radius: 5px;
        overflow-y: scroll;
      }
      .input {
        margin-top: 10px;
      }
      .input input[type="text"] {
        width: calc(100% - 60px);
        padding: 5px;
        font-family: monospace;
        border: 1px solid #ccc;
        border-radius: 3px;
      }
      .input button {
        padding: 5px 10px;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 3px;
        cursor: pointer;
      }
      .input button:hover {
        background-color: #0056b3;
      }
    </style>
  </head>
  <body>
    <h1>Piezo Detection Value</h1>
    <h3>PDV: <span id="piezoValue">-</span></h3>
    <h3>Threshold: <span id="vibrationThreshold">-</span></h3>
    <h3>Trigger duration: <span id="triggerDuration">-</span></h3>
    <h3>Trigger state: <span id="triggerState">-</span></h3>

    <h1>Debug console</h1>
    <div class="console">
      <div class="output" id="output"></div>
      <div class="input">
        <input type="text" id="input" placeholder="Type a command..." />
        <button onclick="send()">Send</button>
      </div>
    </div>

    <script>
      let triggerActive = false; // Global variable to track trigger state

      function fetchDataAndUpdate() {
        fetch("/data")
          .then((response) => response.json())
          .then((data) => {
            document.getElementById("piezoValue").innerText = data.piezoValue;
            document.getElementById("vibrationThreshold").innerText =
              data.vibrationThreshold;
            document.getElementById("triggerDuration").innerText =
              data.triggerDuration;
            document.getElementById("triggerState").innerText =
              data.triggerState;

            // Check if triggered
            if (data.triggerState > 0 && !triggerActive) {
              triggerActive = true; // Set trigger active
              // Set background color to red
              document.body.style.backgroundColor = "red";
              // Add trigger to console
              document.getElementById("output").innerHTML +=
                "<div>Trigger!</div>";
              // Reset background color after triggerDuration
              setTimeout(() => {
                triggerActive = false; // Reset trigger state
                document.body.style.backgroundColor = "white"; // Set background color to white
              }, data.triggerDuration);
            }
          })
          .catch((error) => console.error("Error fetching data:", error));
      }

      setInterval(fetchDataAndUpdate, 50);

      function send() {
        var input = document.getElementById("input").value.trim();
        if (input !== "") {
          document.getElementById("output").innerHTML +=
            "<div>> " + input + "</div>";
          execute(input);
          document.getElementById("input").value = "";
        }
      }

      function execute(command) {
        fetch("/send-command", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ command: command.toLowerCase() }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              document.getElementById("output").innerHTML +=
                "<div>Response: " + data.response + "</div>";
            } else {
              document.getElementById("output").innerHTML +=
                "<div>Error executing command</div>";
            }
          })
          .catch((error) => console.error("Error sending command:", error));
      }

      document
        .getElementById("input")
        .addEventListener("keyup", function (event) {
          if (event.key === "Enter") {
            send();
          }
        });
    </script>
  </body>
</html>
